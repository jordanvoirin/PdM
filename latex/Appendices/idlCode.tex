\chapter{IDL Code}
\label{AppIDLCode}

\section{Shack-Hartmann Acquisition Code}
\label{app:SHacquisCode}

\subsection{readAndAverageSHdata.pro}
\label{subapp:readAndAverageSHdata}

\begin{lstlisting}
function readAndAverageSHdata, folderPath

fileExt='*.csv'

files = file_search(folderPath+fileExt)

r = readshwfsdata(files[0])

NFiles = n_elements(files)

for ifile = 1,Nfiles-1 do begin
  
  rtmp = readshwfsdata(files[ifile])
  
  r.wavefront = r.wavefront+rtmp.wavefront
  r.zernike[3,*] = r.zernike[3,*]+rtmp.zernike[3,*]
  
endfor

r.wavefront = r.wavefront / NFiles
r.zernike[3,*] = r.zernike[3,*] / Nfiles

return, r
end
\end{lstlisting}

\subsection{readSHWFSdata.pro}
\label{subapp:readSHWFSdata}

\begin{lstlisting}
function readSHWFSdata, filePath

openr, f, filePath, /GET_LUN

iLine = 0
line = ''


coefficient = []
index = []
order = []
frequency = []
wavefront = []

while ~EOF(f) do begin
  readf, f, line
  iLine += 1
  
  ;get the zernike coefficient
  if strmatch(line,'* ZERNIKE FIT *') then begin
    subheaderNbrLines = 5
    for isHd =1,subheaderNbrLines do begin
      readf, f, line
      iLine += 1
    endfor
    
    readf, f, line
    iLine += 1
    sLine = strsplit(line,',',/EXTRACT)
    
    while stregex(sLine[0],'[0-9]+') ne -1 and ~EOF(f) do begin
      index = [[index],[long(sLine[0])]]
      order = [[order],[long(sLine[1])]]
      frequency = [[frequency],[long(sLine[2])]]
      coefficient = [[coefficient],[double(sLine[3])]]
      readf, f, line
      iLine += 1
      sLine = strsplit(line,',',/EXTRACT)
    endwhile
  endif
  
  if strmatch(line,'\*\*\* WAVEFRONT \*\*\*')  then begin
    subheaderNbrLines = 11
    for isHd =1,subheaderNbrLines do begin
      readf, f, line
      iLine += 1
    endfor
    readf, f, line
    iLine += 1
    sLine = strsplit(line,',',/EXTRACT)
    nel = n_elements(sLine)
    while stregex(sLine[0],'[0-9]+') ne -1 and ~EOF(f) do begin
      wavefront = [[wavefront],[double(sLine[1:nel-1])]]
      readf, f, line
      iLine += 1
      sLine = strsplit(line,',',/EXTRACT)
    endwhile
    
  endif
endwhile
free_lun, f

zernike = [index,order,frequency,coefficient]

return, {zernike:zernike,wavefront:wavefront}

end
\end{lstlisting}