
\chapter{Theoretical background} 
\label{ch:THback}

In this chapter, we will present the theory upon which this work is based. First, the light propagation formalism will be reminded through the scalar diffraction theory based on the \citet{goodman_1968}. Then we will describe in general an imaging system and its properties. And finally we will discuss the wavefront aberration theory.

\section{Scalar Diffraction Theory}
\label{sec:ScaDifTh}

\subsection{Scalar Field and Helmholtz equation}
\label{subsec:ScalF_HelmEqt}

A monochromatic wave, at position $P$ and time $t$, can be represented by a scalar field $u(P,t)$ written as :

\begin{equation}
u(P,t) =  A(P) exp\left[-j2\pi\nu t + j\phi(P)\right],
\label{eqt:WvscalarField}
\end{equation}

where $A(P)$ and $\phi(P)$ are the amplitude and phase, respectively, of the wave at position P and $\nu$ is the wave frequency.

The spatial part of eqt. \eqref{eqt:WvscalarField}, also called  phasor  in the literature, 

\begin{equation}
U(P) = A(P)e^{j\phi(P)},
\label{eqt:phasor}
\end{equation}

must verify the Helmotz equation : 

\begin{equation}
(\nabla^2 + k^2)U = 0,
\label{eqt:HelmholtzEqt}
\end{equation}

where $k$ is the wave number given by

\begin{equation}
k = 2\pi n \frac{\nu}{c} = \frac{2\pi}{\lambda},
\label{eqt:wavenumber}
\end{equation}

and $\lambda$ is the wavelength in the dielectric medium.


\subsection{Rayleigh-Sommerfeld integral}
\label{subsec:Ray_Som_int}

\begin{figure}
\centering
    \begin{subfigure}{0.4\textwidth}
        \includegraphics[width=\textwidth]{Figures/Ray_Som_Diff}
        \caption{Rayleigh-Sommerfeld formulation of diffraction by a plane screen, \citep[Chapter 3.5]{goodman_1968}.}
        \label{subfig:Ray_Som_Diff}
    \end{subfigure}
    \quad
    \begin{subfigure}{0.5\textwidth}
        \includegraphics[width=\textwidth]{Figures/Diff_Geom}
        \caption{Diffraction geometry, \citep[Chapter 4.1]{goodman_1968}.}
        \label{subfig:Diff_Geom}
    \end{subfigure}
    \decoRule
    \caption{Diffraction Schemas}
    \label{fig:Diff_Schemas}
\end{figure}

Rayleigh and Sommerfeld developed a formalism using the Helmholtz equation and Green's Theorem to compute the induced diffraction by a plane screen. Let's suppose that we have a monochromatic source at $\widetilde{P_0}$ on the left of a plane screen with aperture $\Sigma$, the Rayleigh-Sommerfeld formula allows to compute the complex amplitude at $P_0$ on the right of the plane screen (see Figure \ref{subfig:Ray_Som_Diff}).

\begin{equation}
U(P_0) = \frac{1}{j\lambda} \iint\limits_{\Sigma} U'(P_1)\frac{exp(jkr_{01})}{r_{01}}cos(\mathbf{n},\mathbf{r_{01}})\mathbf{ds}
\label{eqt:Ray_Som_Formula}
\end{equation}

$U'(P_1)$ is the complex amplitude on the screen, $cos(\mathbf{n},\mathbf{r_{01}})$ is the cosine of the angle between the aperture plane normal toward the source and the vector $\mathbf{r_{01}} = \mathbf{P_0P_1}$ given by 

\begin{equation}
r_{01} = \sqrt{z^2 + (x-\xi)^2 + (y-\eta)^2}.
\label{eqt:r_01}
\end{equation}

We can rewrite eqt. \eqref{eqt:Ray_Som_Formula} using $cos(\mathbf{n},\mathbf{r_{01}}) = cos(\theta) = \frac{z}{r_{01}}$ and the coordinate systems ($\xi,\eta$) and ($x,y$), see Figure \ref{subfig:Diff_Geom},

\begin{equation}
U(x,y) = \frac{z}{j\lambda} \iint\limits_{-\infty}^{\infty} U(\xi,\eta)\frac{exp(jkr_{01})}{r_{01}^2} d\xi d\eta.
\label{eqt:Ray_Som_formula_xy_en}
\end{equation}

We can integrate from $-\infty$ to $\infty$, using $U(\xi,\eta) = P(\xi,\eta)U'(\xi,\eta)$ where $P(\xi,\eta)$ is the pupil function. The latter equals to one in the pupil and zero outside. 

\subsection{Fresnel approximation}
\label{subsec:FresnelApprox}

To reduce eqt. \eqref{eqt:Ray_Som_formula_xy_en}, also known as the Huygens-Fresnel principle, one can approximate the distance $r_{01}$ using the taylor expansion of the square root :

\begin{equation}
r_{01} = z \sqrt{1 + \frac{x-\xi}{z} + \frac{y-\eta}{z}} \approx z \left[1+\frac{1}{2}\left(\frac{x-\xi}{z}\right)^2+\frac{1}{2}\left(\frac{y-\eta}{z}\right)^2\right]
\label{eqt:approx_r01}
\end{equation}

To obtain the Fresnel approximation, one has to replace $r_{01}$ by eqt. \eqref{eqt:approx_r01} in eqt. \eqref{eqt:Ray_Som_formula_xy_en}. At the denominator, only the first term $z$ is kept, since the introduced error is small, but in the exponential everything is kept. Then the final expression is given by,

\begin{equation}
U(x,y) = \frac{e^{jkz}}{j\lambda z} \iint\limits_{-\infty}^{\infty} U(\xi,\eta)exp \left\lbrace j \frac{k}{2z}\left[(x-\xi)^2+(y-\eta)^2\right]\right\rbrace d\xi d\eta.
\label{eqt:fresnel_Approx_conv}
\end{equation}

In this form, the Fresnel approximation can be seen as a convolution between $U(\xi,\eta)$ and $h(x,y) = \frac{e^{jkz}}{j\lambda z}exp\left[\frac{jk}{2z}\left(x^2+y^2\right)\right]$.

Another form is found by developing $\left[(x-\xi)^2+(y-\eta)^2\right]$,

\begin{equation}
U(x,y) = \frac{e^{jkz}}{j\lambda z} e^{j\frac{k}{2z}(x^2+y^2)} \iint\limits_{-\infty}^{\infty} \left\lbrace U(\xi,\eta) e^{j\frac{k}{2z}(\xi^2+\eta^2)}\right\rbrace e^{-j\frac{2\pi}{\lambda z}(x\xi+y\eta)} d\xi d\eta,
\label{eqt:fresnel_Approx_FT}
\end{equation}

it is the Fourier transform of the complex field in the pupil multiplied by a quadratic phase exponential.

\subsection{Fraunhofer approximation}
\label{subsec:FraunhoferApprox}

In addition to the Fresnel approximation, we can introduce another approximation using the condition,

\begin{equation}
z >> \frac{k(\xi^2+\eta^2)_{max}}{2}.
\label{eqt:Fraun_Cond}
\end{equation}

If eqt. \eqref{eqt:Fraun_Cond} is satisfied the Fresnel approximation simplifies, since the quadratic phase factor in $(\xi,\eta)$ is approximately one on the entire pupil, as

\begin{equation}
U(x,y) = \frac{e^{jkz}}{j\lambda z} e^{j\frac{k}{2z}(x^2+y^2)} \iint\limits_{-\infty}^{\infty} U(\xi,\eta) e^{-j\frac{2\pi}{\lambda z}(x\xi+y\eta)} d\xi d\eta.
\label{eqt:Fraunhofer_approx}  
\end{equation}

For instance, at a wavelength of 637.5 nm and a pupil diameter of 3.6 mm the Fraunhofer approximation constrain $z$ to be greater than 63 meters to be valid.

\subsection{Converging lens introduction}
\label{subsec:ConvLensIntro}

The Fraunhofer conditions are severe as shown above, but one can reduce the distance $z$ by observing at the focal plane of a converging lens. Indeed, using the paraxial approximation, i.e. small angles with respect with the optical axis, the lens transmission function is given by,

\begin{align}
t_l(\xi , \eta) &= exp \left[ j k n \Delta_0 \right] exp \left[ -jk \left( n-1 \right)\frac{ \xi^2 + \eta^2 }{2}\left( \frac{1}{R_1} - \frac{1}{R_2}\right) \right] \nonumber \\ 
&= exp \left[ -j \frac{k}{2f} (\xi^2+\eta^2) \right] ,
\label{eqt:lensTl}
\end{align}

where $n$ is the refractive index of the lens material, $R_1$ and $R_2$ are the radii of curvature of the front and back surface of the lens, respectively and f is the focal length of the lens defined as,

\begin{equation}
\frac{1}{f} \equiv (n-1)\left(\frac{1}{R_1}-\frac{1}{R_2}. \right)
\label{eqt:focal_length}
\end{equation}

We can define $U_l(\xi,\eta) = U(\xi,\eta)t_l(\xi,\eta)$, which represents the complex amplitude passing through a lens. Finally, replacing $U(\xi,\eta)$ by $U_l(\xi,\eta)$ in Fresnel approximation and setting the observing distance to the focal length of the converging lens, we recover the Fraunhofer approximation,

\begin{align}
U(x,y) &= \frac{e^{jkz}}{j\lambda z} e^{j\frac{k}{2z}(x^2+y^2)}  \mathcal{F}\left\lbrace U(\xi,\eta) exp\left[j\frac{k}{2}(\xi^2+\eta^2)(\frac{1}{z}-\frac{1}{f})\right]\right\rbrace \nonumber \\
&\overset{z=f}{=} \frac{e^{jkz}}{j\lambda z} e^{j\frac{k}{2z}(x^2+y^2)}  \mathcal{F}\left\lbrace U(\xi,\eta)\right\rbrace.
\end{align}

\section{Imaging system}
\label{sec:ImSystem}

\begin{figure}
\begin{center}
\includegraphics[width=0.8\textwidth,angle=0]{Figures/ImagingInstrumentGenSchema}
\decoRule
\caption{Schema of a imaging instrument, \citep[Chapter 6.1]{goodman_1968}}
\label{fig:ImagingInstrumentGenSchema}
\end{center}
\end{figure}

An imaging system, such as a telescope, is used to acquire images of an object as perfectly as possible. An optical system,  forming an instrument, is composed by lenses, mirrors, etc... and a detector (can be the human eye). A complex optical system can be reduced to a pupil, $P(\xi,\eta)$, and a focal length, $f$. The diffraction of the wave can be determined by the Fraunhofer approximation as long as the paraxial approximation is valid, see subsection \ref{subsec:ConvLensIntro}. And the observed image of an incoherent object at the focal plane of the system is proportional to the square modulus of the complex amplitude $U(x,y)$,

%\begin{equation}
%i(x,y) \alpha |\left[\mathcal{F}\left\lbrace U(\xi,\eta) \right\rbrace\right](x,y)|^2.
%\label{eqt:i_modu_FT}
%\end{equation}

\subsection{Impulse Response (IR)}
\label{subsec:IR}

\begin{figure}
\centering
    \begin{subfigure}{0.4\textwidth}
        \includegraphics[width=\textwidth]{Figures/PSF}
        \caption{PSF}
        \label{subfig:PSF}
    \end{subfigure}
    \quad
    \begin{subfigure}{0.4\textwidth}
        \includegraphics[width=\textwidth]{Figures/PSFzoom}
        \caption{PSF zoom x10}
        \label{subfig:PSFzoom}
    \end{subfigure}
    \decoRule
    \caption{PSF of a perfect imaging system composed by a 3.6 mm pupil and a focal length of 80 mm at a wavelength of 637.5 nm. The size, N, of the PSF is 400 and the pixel size is 5.3 $\mu m$.}
    \label{fig:PSF}
\end{figure} 

The impulse response or point spread function (PSF), $h(x,y;u,v)$, of an optical system is  the field amplitude induced at coordinates $(x,y)$ by a unit-amplitude point source at object coordinates $(u,v)$. Using the linearity of the wave propagation, we can write the imaged amplitude as the superposition integral,

\begin{equation}
U(x,y) = \iint_{-\infty}^{\infty} h(x,y;u,v)U(u,v)dudv
\label{eqt:superpositionIntegral}
\end{equation}

\subsection{Optical Transfer Function (OTF)}
\label{subsec:OTF}

\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth,angle=0]{Figures/OTF}
\decoRule
\caption{OTF of a perfect imaging system composed by a 3.6 mm pupil and a focal length of 80 mm at a wavelength of 637.5 nm.}
\label{fig:OTF}
\end{center}
\end{figure}

The optical transfer function, OTF, is defined as the Fourier transform of the impulse response, see Figure \ref{fig:OTF}. Using the Fourier transform properties it can also be given by the autocorrelation of the pupil function,

\begin{equation}
\overset{\sim}{h}_{optical}(\xi,\eta) = \mathcal{F}\left\lbrace h_{optical}(x,y)\right\rbrace = (P \otimes P)(\xi,\eta),
\label{eqt:OTF}
\end{equation}

where $\xi$ and $\eta$ are the conjugate variables of $x$ and $y$ with respect to the Fourier transform.

\subsection{From Object to Image}
\label{subsec:FromOtoI}

A detector only senses the energy distribution produced by an electromagnetic wave. Therefore, an image is given by the square modulus of the complex amplitude at the focal plane,

\begin{equation}
i(x,y) = |U(x,y)|^2 = |\iint_{-\infty}^{\infty} h(x,y;u,v)U(u,v)dudv|^2.
\label{eqt:IsqAmplitude}
\end{equation}

This integral simplifies differently depending on the type of object we are observing. For a coherent object, \citet[Chapter 6.2]{goodman_1968} showed that the imaging is linear in complex amplitude, thus eqt. \eqref{eqt:IsqAmplitude} becomes,

\begin{equation}
i(x,y) = |\iint_{-\infty}^{\infty} h(x-\overset{\sim}{u},y-\overset{\sim}{v})U(\overset{\sim}{u},\overset{\sim}{v})d\overset{\sim}{u}d\overset{\sim}{v}|^2,
\label{eqt:convolution_hUo}
\end{equation}

where $(\overset{\sim}{u} = Mu,\overset{\sim}{v}= Mv)$ are the normalized object coordinates and $M$ is the magnification of the imaging system. The image is given by the squared modulus of the convolution of the impulse response and the object complex amplitude.

For an incoherent object,  \citet[Chapter 6.2]{goodman_1968} showed that the imaging is linear in intensity,

\begin{equation}
i(x,y) = \iint_{-\infty}^{\infty}|h(x-\overset{\sim}{u},y-\overset{\sim}{v})|^2o(\overset{\sim}{u},\overset{\sim}{v})d\overset{\sim}{u}d\overset{\sim}{v} = (h_{optical}\otimes o)(x,y),
\label{eqt:imageObjectrel}
\end{equation}

where $o(x,y) = |U(x,y)|^2$. We can recognize the convolution of an object with an intensity impulse response, $h_{optical}(x,y) = |h(x,y)|^2$. 

The image that an optical system gives of a point source is called the point spread function, PSF, or impulse response, IR, of the system, see Figure \ref{fig:PSF}. A point source is characterized by an infinite distance to the instrument and therefore the wave is planar, which means that $U(\xi,\eta) = P(\xi,\eta)$. The PSF or IR is given by,

\begin{equation}
h_{optical}(x,y) = |\left[\mathcal{F}\left\lbrace P(\xi,\eta) \right\rbrace\right](x,y)|^2
\label{eqt:impulseResponse}
\end{equation}

The domain where the impulse response is invariant under translation is called the \textbf{isoplanatic domain}.



\section{Aberrations}
\label{sec:Aberrations}

\subsection{Sources of aberrations}
\label{subsec:SourcesAb}

\subsection{Zernike polynomials}
\label{subsec:ZernikePol}